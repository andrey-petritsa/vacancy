FROM python:3.11 AS base
RUN pip install poetry
WORKDIR /app
COPY pyproject.toml poetry.lock ./
RUN poetry config virtualenvs.create false

FROM base AS dev
RUN poetry install --with dev --no-interaction --no-ansi --no-root
CMD ["poetry", "run", "python", "vacancy/main/main.py", "run"]

# ===== Test =====
FROM base AS test
COPY . .
RUN poetry install --with dev --no-interaction --no-ansi --no-root
CMD ["./run_tests.sh"]

# ===== Prod =====
FROM base AS prod
COPY . .
RUN poetry install --without dev --no-interaction --no-ansi --no-root
CMD ["poetry", "run", "python", "vacancy/main/main.py", "run"]