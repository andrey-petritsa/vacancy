FROM python:3.13-slim AS base
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    build-essential \
    libssl-dev \
    libffi-dev \
    && rm -rf /var/lib/apt/lists/*

ENV TZ=Europe/Moscow

RUN pip install --no-cache-dir poetry
WORKDIR /app

COPY back /app/back
COPY tests /app/tests

RUN poetry config virtualenvs.create false \
 && poetry install --no-interaction --no-ansi --no-root -C /app/back

ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/app/back/src:/app/tests

CMD ["pytest", "tests"]